<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.yedam.zippy.property.mapper.PropertyMapper">
	<select id="getAllPropertyList" resultType="PropertyVO">
		select * from
		house_product
	</select>

	<select id="getAgentEmail" parameterType="Integer"
		resultType="String">
		select email from house_product where product_id =
		#{productId}
	</select>

	<select id="gethouseDetail" parameterType="Integer"
		resultType="propertyVO">
		<!-- select * from house_product p join house_detail d on p.product_id 
			= d.product_id where p.product_id = #{productId} -->
		select p.*, d.*, b.comp_name
		from house_product p join house_detail d
		on p.product_id = d.product_id join business b
		on p.email = b.email
		where p.product_id = #{productId}
	</select>

	<select id="getAgentProperties" parameterType="String"
		resultType="propertyVO">
		select * from house_product where email = #{email}
	</select>

	<select id="getAgentProfile" parameterType="String"
		resultType="agentVO">
		select * from business where email = #{email}
	</select>

	<select id="getCompName" parameterType="String"
		resultType="String">
		select comp_name from business where email = #{email}
	</select>

	<insert id="insertHouseProduct" parameterType="propertyVO">
		<selectKey keyProperty="productId" order="BEFORE"
			resultType="int">
			SELECT NVL(MAX(product_id),0) +1 FROM house_product
		</selectKey>
		insert into
		house_product(
		product_id, email, main_img,
		house_name, sale_type, price,
		sigungu, house_type, floor,
		area_exclusive, room_cnt, detail_contents
		) values(#{productId}, #{email}, #{mainImg},
		#{houseName}, #{saleType}, #{price},
		#{sigungu}, #{houseType}, #{floor},
		#{areaExclusive}, #{roomCnt}, #{detailContents}
		)
	</insert>
	
	<insert id="insertHouseDetail" parameterType="propertyVO">
		insert into
		house_detail(
		detail_id, product_id,
		bath_cnt, parking, house_face,
		construction_year, tags, street_address
		) values( 
		(SELECT NVL(MAX(product_id),0) +1 FROM house_detail),
		(SELECT NVL(MAX(product_id),0) +1 FROM house_detail),
		#{bathCnt}, #{parking}, #{houseFace},
		#{constructionYear}, #{tags}, #{streetAddress}
		)
	</insert>

	<update id="updateHouseProduct" parameterType="propertyVO">
		update house_product
		set product_state = #{productState}, 
		main_img = #{mainImg},
		house_name = #{houseName},
		sale_type = #{saleType},
		price = #{price},
		sigungu = #{sigungu},
		house_type = #{houseType},
		floor = #{floor},
		area_exclusive = #{areaExclusive},
		room_cnt = #{roomCnt},
		detail_contents = #{detailContents}
		where product_id = #{productId}
	</update>

	<update id="updateHouseDetail" parameterType="propertyVO">
		update house_detail
		set street_address = #{streetAddress},
		house_face = #{houseFace},
		parking = #{parking},
		bath_cnt = #{bathCnt},
		construction_year =
		#{constructionYear},
		tags = #{tags}
		where product_id = #{productId}
	</update>
	
	<update id="updateAgentProfile" parameterType="agentVO">
		update business
		set comp_name = #{compName},
		comp_intro = #{compIntro},
		comp_address = #{compAddress},
		profile_pic = #{profilePic},
		phone = #{phone},
		business_img = #{businessImg},
		broker_img = #{brokerImg},
		business_id = #{businessId},
		broker_id = #{brokerId}
		where email = #{email}
	</update>
</mapper>